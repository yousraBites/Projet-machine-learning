---
title: "Projet machine learning"
author: "Yousra AMACHAT, Tomilli RAKOTOZAFY et Thiziri BENABDELAZIZ" 
date: "2025-02-25"
output: html_document ??????????????
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loan Approval Classification Dataset

## **1. Description Générale**

1.  Le contexte de notre jeu de données :

    Ce jeu de données porte sur des demandes de prêts soumises à un établissement financier. Chaque observation représente un individu ayant sollicité un prêt, avec un ensemble de variables caractérisant :

    -   Les informations personnelles (âge, revenu, genre, statut d’occupation du logement…)

    -   L’expérience professionnelle

    -   Le montant du prêt et son objectif,

    -   L’historique de crédit (score, défauts précédents, etc.).

    L’idée est donc de répertorier toutes ces informations afin de mieux comprendre les profils des demandeurs et de prévoir la probabilité d’acceptation ou de rejet du prêt.

2.  Notre objectif :

    L’objectif principal est de construire un modèle de classification permettant de déterminer si un nouveau demandeur aura son prêt approuvé (“loan_status”) ou non, en fonction des caractéristiques et du comportement crédit de l’individu (âge, revenus, historique de crédit, etc.).

## **2. Jeu de données :**

1.  Charger le jeu de données :

    Le jeu de données est sous format **csv.**

    Nous avons relevé des individus dont l’âge dépassait 100 ans, voire 123 ans, ce qui nous a semblé irréaliste dans le cadre de cette étude (notamment pour expliquer 101 ans d’expérience professionnelle). De tels enregistrements s’apparentent fortement à des erreurs de saisie et risquent de biaiser notre analyse. Nous avons donc choisi de supprimer ces observations pour maintenir la cohérence et la fiabilité de notre jeu de données.

    ```{r}
    data=read.csv("C:\\Users\\yousr\\Desktop\\projet ml\\loan_data.csv")
    nrow(data[data$person_age > 100, ]) 
    which(data$person_age > 100)
    idx = which(data$person_age > 100) 
    data = data[-idx, ] 
    nrow(data[data$person_age > 100, ]) #pour êtres sur que les ligne sont supprimees.
    ```

2.  Caractéristiques de jeu de données :

    ```{r}
    nrow(data) 
    ncol(data) 
    boxplot(data$person_age, main = "Distribution de l'âge")
    max(data$person_age)
    summary(data$person_age)
    colSums(is.na(data))

    #dim(data)
    ```

    Il y a 45 000 individus et 14 variables dans ce jeu de données.

3.  Variables :

    ```{r}
    colnames(data) 
    #str(data).
    head(data) 
    sapply(data, class)
    ```

    une description courte de chacune des variables et leur types :

    -   Variables quantitatives (numériques) :

        -   person_age : Âge de la personne, emprunteur.

        -   person_income : Revenu annuel de la personne.

        -   person_emp_exp : Expérience professionnelle en années.

        -   loan_amnt : Montant du prêt demandé.

        -   loan_int_rate : Taux d’intérêt du prêt.

        -   loan_percent_income : Pourcentage du revenu utilisé pour rembourser le prêt.

        -   cb_person_cred_hist_length : Longueur de l’historique de crédit de la personne (en années).

        -   credit_score : Score de crédit de la personne (l’échelle FICO).

        -   loan_status : Statut final du prêt.

    -   Variables qualitatives (catégorielles) :

        -   person_gender : Genre de la personne.

        -   person_education : Niveau d’éducation atteint.

        -   person_home_ownership : Statut de propriété du logement.

        -   loan_intent : Objet ou but du prêt.

        -   previous_loan_defaults_on_file : Indique si la personne a déjà fait défaut sur un prêt.

4.  Target :

    La variable qui sera le target est loan_status.

    ```{r}
    #target=data$loan_status
    ```

5.  Variables peu pertinentes :

    Avant de poursuivre notre analyse, **nous** avons jugé nécessaire d’identifier **d’autres** variables pouvant être considérées comme moins pertinentes, que ce soit en raison de risques de biais ou de discrimination, ou encore de redondances liées à d’autres variables plus informatives. Voici les principales concernées :

    -   person_gender : pour éviter d’introduire un risque de discrimination

    -   person_education : peut introduire des biais (pour des questions éthiques)

    -   person_income et loan_amnt : elles sont corrélées avec loan_percent_income, qui est un ratio dérivé de ces deux variables 



6.  Transformation des variables :
         -  la standarisation des variables 
      # Liste des variables numériques à standardiser
numeric_vars <- c("person_age", "person_income", "person_emp_exp", 
                  "loan_amnt", "loan_int_rate", "loan_percent_income", 
                  "cb_person_cred_hist_length", "credit_score")

# Appliquer la standardisation (z-score)
data[numeric_vars] <- scale(data[numeric_vars])

# Vérifier le résultat
summary(data[numeric_vars])

        ```{r}
        target <- factor(
          target,
          levels = c(0, 1),
          labels = c("approved", "rejected")
        )
        class(target) 
        ```

    -   La transformation des variables catégorielles en factor :

        ```{r}

        ```

    -   La transformation de person_home_ownership et loan_intent en label encoding

        ```{r}
data$loan_intent <- as.factor(data$loan_intent)
data$loan_intent <- as.numeric(data$loan_intent)

data$person_home_ownership <- as.factor(data$person_home_ownership)
data$person_home_ownership <- as.numeric(data$person_home_ownership)
        ```

    -   La discrétisation de person_age et credit_score :

        ```{r}
```{r, results = "hide"}
data$person_age <- cut(data$person_age,
                     breaks = c(20, 25, 123),
                     labels = c("20-25", "26-123"),
                     right = TRUE,
                     include.lowest = TRUE)


data$credit_score_cat <- cut(data$credit_score,
                           breaks = c(-Inf, 579, 669, 739, 799, Inf),
                           labels = c("Poor", "Fair", "Good", "Very Good", "Excellent"),
                           right = TRUE)
        ```

    -   La transformation de pevious_loan_defaults_on_file en binaire (yes = 1 et no=0)

        ```{r}
data$previous_loan_defaults_on_file <- ifelse(data$previous_loan_defaults_on_file == "Yes", 1, 0)

        ```

7.  Variables prédictives :

## **3. Analyse descriptive (univariee):**

1.  Analyse statistique descriptive :

    a\. variables quantitatives :
quantitative_vars <- select(data, 
                            person_emp_exp, 
                            credit_score, 
                            loan_int_rate, 
                            loan_percent_income, 
                            cb_person_cred_hist_length)

 # Calcul des statistiques de base pour chaque variable
summary(quantitative_vars)

# Calcul de l'écart-type pour chaque variable
sapply(quantitative_vars, sd, na.rm = TRUE)

    b\. variables qualitatives :
qualitative_vars <- select(data, 
                           person_home_ownership, 
                           loan_intent, 
                           previous_loan_defaults_on_file, 
                           high_credit_risk)

# Conversion des variables qualitatives en facteur
data$person_home_ownership <- as.factor(data$person_home_ownership)
data$loan_intent <- as.factor(data$loan_intent)
data$previous_loan_defaults_on_file <- as.factor(data$previous_loan_defaults_on_file)
data$high_credit_risk <- as.factor(data$high_credit_risk)
data$person_age_cat <- as.factor(data$person_age_cat)

# Assurer que la variable cible est aussi un facteur
data$loan_status <- as.factor(data$loan_status)

# Nombre d'observations dans chaque catégorie des variables qualitatives
lapply(qualitative_vars, table)

ou 
table(qualitative_vars$person_age_cat)

2.  Analyse graphiques :

    a\. variables quantitatives :
library(ggplot2)

# Histogramme - Expérience pro
ggplot(quantitative_vars, aes(x = person_emp_exp)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "black") +
  theme_minimal() +
  labs(title = "Expérience professionnelle", x = "Années d'expérience", y = "Fréquence")

# Histogramme - Credit score 
ggplot(quantitative_vars, aes(x = credit_score)) +
  geom_histogram(bins = 30, fill = "lightgreen", color = "black") +
  theme_minimal() +
  labs(title = "Score de crédit ", x = "Score", y = "Fréquence")

# Histogramme - Taux d'intérêt 
ggplot(quantitative_vars, aes(x = loan_int_rate)) +
  geom_histogram(bins = 30, fill = "orange", color = "black") +
  theme_minimal() +
  labs(title = "Taux d'intérêt ", x = "Taux ", y = "Fréquence")

# Histogramme - Pourcentage du revenu 
ggplot(quantitative_vars, aes(x = loan_percent_income)) +
  geom_histogram(bins = 30, fill = "purple", color = "black") +
  theme_minimal() +
  labs(title = "Part du revenu affectée au prêt ", x = "Ratio prêt/revenu", y = "Fréquence")

# Histogramme - Longueur historique crédit
ggplot(quantitative_vars, aes(x = cb_person_cred_hist_length)) +
  geom_histogram(bins = 30, fill = "tomato", color = "black") +
  theme_minimal() +
  labs(title = "Historique de crédit (en années)", x = "Longueur historique", y = "Fréquence")



    b\. variables qualitatives :

## **4. Analyse descriptive (multivariee):**

1.  Variables quantitatives :

2.  Variables quantitatives et target :

3.  variables qualitatives et target :

## **5. Données manquantes :**

1.  Identifier les variables avec des données manquantes :

2.  Gerer les variables manquantes :

```{r}
data=read.csv("C:\\Users\\yousr\\Desktop\\projet ml\\loan_data.csv")
head(data)
dim(data)
summary(data)
colSums(is.na(data))
colnames(data)
boxplot(data$person_age, main = "Distribution de l'âge")

#comptent le nombre de lignes dont l’âge (person_age) est supérieur ou égal à 100 .
nrow(data[data$person_age > 100, ])
length(which(data$person_age > 100))

#donne les indices des lignes de ces personnes 
which(data$person_age > 100)

#on stocke dans une variables et on les supprime
idx <- which(data$person_age > 100)
data <- data[-idx, ]
nrow(data[data$person_age > 100, ])

```

```{r}
yousr = data[-c()]
```



















































